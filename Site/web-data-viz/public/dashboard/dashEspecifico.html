<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Noctoramento | Dashboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Jura:wght@300..700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/dashEspecifico.css" />
    <link rel="icon" href="../assets/Imagens/Logo Principal Verde água neon.png" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <nav class="navbar">
        <img class="imgNavbar" src="../assets/icons_img/Logo Verde água escuro.png" alt="" />
        <ul class="iconsNavbar">

            <li onclick="trocarTela('dashGeral')">
                <svg class="icons_azul" width="27" height="32" viewBox="0 0 24 24" fill="white"
                    xmlns="http://www.w3.org/2000/svg">
                    <path
                        d="M4 8L3.29289 8.70711L2.58579 8L3.29289 7.29289L4 8ZM9 20C8.44772 20 8 19.5523 8 19C8 18.4477 8.44772 18 9 18L9 20ZM8.29289 13.7071L3.29289 8.70711L4.70711 7.29289L9.70711 12.2929L8.29289 13.7071ZM3.29289 7.29289L8.29289 2.29289L9.70711 3.70711L4.70711 8.70711L3.29289 7.29289ZM4 7L14.5 7L14.5 9L4 9L4 7ZM14.5 20L9 20L9 18L14.5 18L14.5 20ZM21 13.5C21 17.0898 18.0898 20 14.5 20L14.5 18C16.9853 18 19 15.9853 19 13.5L21 13.5ZM14.5 7C18.0898 7 21 9.91015 21 13.5L19 13.5C19 11.0147 16.9853 9 14.5 9L14.5 7Z" />
                </svg>
                <a href="./dashGeral.html"></a>
            </li>

            <li>
                <svg class="icons_azul" width="24" height="24" viewBox="0 0 30 25" fill="white"
                    xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd" clip-rule="evenodd"
                        d="M3.4737 0.0560913C1.7378 0.0560913 0.330566 1.46993 0.330566 3.21399V20.8982C0.330566 22.6423 1.63302 24.0561 3.36893 24.0561H26.5233C28.2592 24.0561 29.6665 22.6423 29.6665 20.8982V3.21399C29.6665 1.46993 28.2592 0.0560913 26.5233 0.0560913H3.4737ZM3.26416 3.21399C3.26416 3.09772 3.35797 3.00346 3.4737 3.00346H9.13134V21.1087H3.4737C3.35797 21.1087 3.26416 21.0145 3.26416 20.8982V3.21399ZM12.0649 21.1087H17.9321V13.5298H12.0649V21.1087ZM12.0649 10.5824V3.00346H26.5233C26.6391 3.00346 26.7329 3.09772 26.7329 3.21399V10.5824L12.0649 10.5824ZM26.7329 13.5298H20.8657V21.1087H26.5233C26.6391 21.1087 26.7329 21.0145 26.7329 20.8982V13.5298Z" />
                </svg>
            </li>

            <li onclick="trocarTela('cadastroFuncionario')">
                <svg class="icons_azul" width="24" height="28" viewBox="0 0 30 25" fill="white"
                    xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd" clip-rule="evenodd"
                        d="M15.9998 13.3334C18.9454 13.3334 21.3332 10.9455 21.3332 8.00002C21.3332 5.0545 18.9454 2.66669 15.9998 2.66669C13.0543 2.66669 10.6665 5.0545 10.6665 8.00002C10.6665 10.9455 13.0543 13.3334 15.9998 13.3334ZM15.9998 10.6667C17.4726 10.6667 18.6665 9.47278 18.6665 8.00002C18.6665 6.52726 17.4726 5.33335 15.9998 5.33335C14.5271 5.33335 13.3332 6.52726 13.3332 8.00002C13.3332 9.47278 14.5271 10.6667 15.9998 10.6667Z" />
                    <path
                        d="M5.80042 20.5798C7.60684 17.9427 10.8276 16 16.0004 16C17.6354 16 19.0819 16.1931 20.3568 16.5477C21.0663 16.745 21.4815 17.4801 21.2842 18.1895C21.0868 18.899 20.3518 19.3141 19.6423 19.1168C18.6291 18.835 17.426 18.6667 16.0004 18.6667C11.5733 18.6667 9.23845 20.2795 8.00043 22.0869C7.00336 23.5424 6.63049 25.2527 6.60028 26.6667H18.6662C19.4026 26.6667 19.9996 27.2636 19.9996 28C19.9996 28.7364 19.4026 29.3334 18.6662 29.3334H5.33376C4.66132 29.3334 4.09412 28.8326 4.01072 28.1654C3.75911 26.1525 4.04942 23.136 5.80042 20.5798Z" />
                    <path
                        d="M25.3332 29.3334C24.5968 29.3334 23.9998 28.7364 23.9998 28V25.3334H21.3332C20.5968 25.3334 19.9998 24.7364 19.9998 24C19.9998 23.2636 20.5968 22.6667 21.3332 22.6667H23.9998V20C23.9998 19.2636 24.5968 18.6667 25.3332 18.6667C26.0695 18.6667 26.6665 19.2636 26.6665 20V22.6667H29.3332C30.0695 22.6667 30.6665 23.2636 30.6665 24C30.6665 24.7364 30.0695 25.3334 29.3332 25.3334H26.6665V28C26.6665 28.7364 26.0695 29.3334 25.3332 29.3334Z" />
                </svg>
                <a href="./cadastroFuncionario.html"></a>
            </li>

            <li onclick="trocarTela('cadastroMaquina')">
                <svg class="icons_azul" width="30" height="33" viewBox="0 0 42 32" fill="white"
                    xmlns="http://www.w3.org/2000/svg">
                    <path
                        d="M35.3333 29.3333C34.597 29.3333 34 28.7363 34 28V25.3333H31.3333C30.597 25.3333 30 24.7363 30 24C30 23.2636 30.597 22.6666 31.3333 22.6666H34V20C34 19.2636 34.597 18.6666 35.3333 18.6666C36.0697 18.6666 36.6667 19.2636 36.6667 20V22.6666H39.3333C40.0697 22.6666 40.6667 23.2636 40.6667 24C40.6667 24.7363 40.0697 25.3333 39.3333 25.3333H36.6667V28C36.6667 28.7363 36.0697 29.3333 35.3333 29.3333Z" />
                    <path fill-rule="evenodd" clip-rule="evenodd"
                        d="M2.88867 9.33329C2.88867 5.65139 5.87344 2.66663 9.55534 2.66663H22.8887C26.5706 2.66663 29.5553 5.65139 29.5553 9.33329V17.3333C29.5553 21.0152 26.5706 24 22.8887 24H9.55534C5.87344 24 2.88867 21.0152 2.88867 17.3333V9.33329ZM9.55534 5.33329C7.3462 5.33329 5.55534 7.12415 5.55534 9.33329V17.3333C5.55534 19.5424 7.3462 21.3333 9.55534 21.3333H22.8887C25.0978 21.3333 26.8887 19.5424 26.8887 17.3333V9.33329C26.8887 7.12415 25.0978 5.33329 22.8887 5.33329H9.55534ZM2.88867 28C2.88867 27.2636 3.48563 26.6666 4.22201 26.6666H28.222C28.9584 26.6666 29.5553 27.2636 29.5553 28C29.5553 28.7363 28.9584 29.3333 28.222 29.3333H4.22201C3.48563 29.3333 2.88867 28.7363 2.88867 28Z" />
                </svg>
                <a href="./cadastroMaquina.html"></a>
            </li>

            <li onclick="trocarTela('maquinaAlocada')">
                <svg class="icons_azul" width="25" height="25" viewBox="0 0 36 36" xmlns="http://www.w3.org/2000/svg">
                    <path class="icons_azul" fill-rule="evenodd" clip-rule="evenodd"
                        d="M14.3933 4.5C8.92939 4.5 4.5 8.92939 4.5 14.3933C4.5 19.8572 8.92939 24.2866 14.3933 24.2866C17.1271 24.2866 19.5996 23.1798 21.3918 21.3861C23.1821 19.5944 24.2866 17.1243 24.2866 14.3933C24.2866 8.92939 19.8572 4.5 14.3933 4.5ZM1.5 14.3933C1.5 7.27253 7.27253 1.5 14.3933 1.5C21.5141 1.5 27.2866 7.27253 27.2866 14.3933C27.2866 17.4109 26.2485 20.1881 24.5122 22.3843L32.5672 30.4393C33.153 31.0251 33.153 31.9749 32.5672 32.5607C31.9814 33.1464 31.0316 33.1464 30.4459 32.5607L22.3916 24.5064C20.1943 26.2462 17.4143 27.2866 14.3933 27.2866C7.27253 27.2866 1.5 21.5141 1.5 14.3933Z"
                        fill="white" />
                </svg>

                <a href="./maquinaAlocada.html"></a>
            </li>
        </ul>

        <span id="logout" onclick="trocarTela('../index')">
            <svg class="icons_azul" width="24" height="30" viewBox="0 0 30 25" fill="white"
                xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M2.6665 5.33329C2.6665 3.86053 3.86041 2.66663 5.33317 2.66663H14.6665C16.1393 2.66663 17.3332 3.86053 17.3332 5.33329V7.99996C17.3332 8.73634 16.7362 9.33329 15.9998 9.33329C15.2635 9.33329 14.6665 8.73634 14.6665 7.99996V5.33329L5.33317 5.33329V26.6666H14.6665V24C14.6665 23.2636 15.2635 22.6666 15.9998 22.6666C16.7362 22.6666 17.3332 23.2636 17.3332 24V26.6666C17.3332 28.1394 16.1393 29.3333 14.6665 29.3333H5.33317C3.86041 29.3333 2.6665 28.1394 2.6665 26.6666V5.33329Z" />
                <path
                    d="M24.7809 17.3333L21.7237 20.3905C21.203 20.9112 21.203 21.7554 21.7237 22.2761C22.2444 22.7968 23.0886 22.7968 23.6093 22.2761L28.7541 17.1313C29.3789 16.5065 29.3789 15.4934 28.7541 14.8686L23.6093 9.72382C23.0886 9.20312 22.2444 9.20312 21.7237 9.72382C21.203 10.2445 21.203 11.0887 21.7237 11.6094L24.7809 14.6666L10.6665 14.6666V17.3333L24.7809 17.3333Z" />
            </svg>
            <a href="../index.html"></a>
        </span>
    </nav>

    <div class="container">
        <div class="containerComPadding">
            <header class="header">
                <div class="tituloDash">
                    <h1 id="tituloVisaoEspecifica">Visão Específica</h1>
                </div>
            </header>

            <div>
                <select id="selectNotebook" onchange="obterUsuarioNotebook(); obterDadosGraficos();">
                    <option value="0" disabled selected>Visualize outra máquina</option>
                </select>
            </div>

            <div class="containerKPIs">
                <div class="kpi">
                    <h5 class="txtMaquinas" style="color: #59d9bb;">Usuário da Máquina</h5>
                    <p class="variavelKPI" id="divKpiUsuario"></p>
                </div>

                <!-- <div class="kpi">
                    <h6 class="txtMaquinas">Condição Geral da Máquina</h6>
                    <p class="variavelKPI" id="condicao_maquina"></p>
                </div> -->

                <div class="kpi">
                    <h6 class="txtMaquinas" style="color: #6963d2">Tempo de Atividade do Disco</h6>
                    <p id="tempo_disco" class="variavelKPINumber"></p>
                </div>

                <div class="kpi" style="width: 13vw;">
                    <h6 class="txtMaquinas" style="width: 13vw; color: #ff7edf;">Disco em Uso</h6>
                    <p id="uso_disco" class="variavelKPINumber"></p>
                </div>
            </div>

            <div class="containerGraficos">
                <div id="primeira_coluna" class="graficosColuna">
                    <div class="graficos">
                        <canvas id="ram"></canvas>
                    </div>

                    <div class="graficos">
                        <canvas id="armazenamento"></canvas>
                    </div>
                </div>

                <div>
                    <div id="segunda_coluna" class="graficosColuna">
                        <div class="graficos">
                            <canvas id="cpu"></canvas>
                        </div>

                        <div class="graficos">
                            <canvas id="janelaAtiva"></canvas>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</body>
<script>

    function trocarTela(tela) {
        window.location.href = `${tela}.html`;
    }

    window.onload = function () {
        listarNotebooks();
        const params = new URLSearchParams(window.location.search);
        const numeroSerie = params.get('serie');
        const emailUsuario = params.get('email');
        if (numeroSerie && emailUsuario) {
            console.log('ENTROU NO IF DO ONLOAD ' + numeroSerie);
            obterDadosGraficos(numeroSerie);
            atualizarTitulo(numeroSerie);
            mostrarDetalhes(numeroSerie, emailUsuario);
            obterDadosEspecificosKpis(numeroSerie);
        }
    }

    function atualizarTitulo(numeroSerie) { //atualiza o numero de serie do titulo conforme o note selecionado no select
        const titulo = document.getElementById('tituloVisaoEspecifica');
        titulo.innerHTML = `Visão da Máquina: <span style="font-size: 22px; color:white;">${numeroSerie}</span>`;
    }

    function mostrarDetalhes(numeroSerie, emailUsuario) { //Quando clicar no ver detalhes na page geral, já carrega a especifica c os dados
        document.getElementById("divKpiUsuario").innerHTML = decodeURIComponent(emailUsuario);
    }

    document.getElementById('selectNotebook').addEventListener('change', function () {
        const numeroSerie = this.value;
        obterDadosEspecificosKpis(numeroSerie);  // Atualiza os dados específicos quando um novo notebook é selecionado
        // obterDadosGraficos(numeroSerie);
    });

    function listarNotebooks() { //traz a lista dos notes pelo numero de serie
        console.log("Estou no listar Notebooks!")
        const fkEmpresa = sessionStorage.getItem('ID_EMPRESA');

        fetch(`/notebook/listarNotebooks/${fkEmpresa}`, {
            method: "GET",
        }).then(function (resposta) {
            if (resposta.status == 200) {
                resposta.json().then(function (jsonNotebooks) {
                    console.log("O que ta vindo do BD: ", jsonNotebooks);
                    listarNotebooksNoSelect(jsonNotebooks);
                    // contarNotebooks(jsonNotebooks);
                    // obterParametros();
                    // listarAlocadas(jsonNotebooks);
                });
            } else {
                console.log("Deu ruim ao listar os Notes");
                resposta.text().then(function (texto) {
                    console.error("Erro: ", texto);
                });
            }
        }).catch(function (erro) {
            console.error("Erro na requisição da função do listar notebooks: ", erro);
        });
    }

    function listarNotebooksNoSelect(jsonNotebooks) { //lista no select os notes pelo SN 
        var select = document.getElementById("selectNotebook");
        jsonNotebooks.forEach(notebook => {
            var novaOpcao = document.createElement("option");
            novaOpcao.value = notebook.numeroSerie;
            novaOpcao.text = notebook.numeroSerie;
            select.appendChild(novaOpcao);
        });
    }

    function obterUsuarioNotebook(numeroSerie) { //Mostra o email do usuario que esta usando a maquina
        if (numeroSerie == null || numeroSerie == '') {
            var numeroSerie = selectNotebook.value;
        }

        fetch(`/notebook/obterUsuarioNotebook/${numeroSerie}`, { cache: 'no-store' })
            .then(function (response) {
                if (response.ok) {
                    response.json().then(function (resposta) {
                        divKpiUsuario.innerHTML = resposta[0].emailUsuario;
                    });
                } else {
                    console.error('ERRO DO OBTER USUARIO ' + response);
                }
            });
        atualizarTitulo(numeroSerie); // revisar essa chamada da function...
    }

    function obterDadosEspecificosKpis(numeroSerie) { //pega da mesma rota dos graficos mas so pega os dados do uso do disco e do tempo de atividade para joga nas kpi
        console.log("DEBUGA Q DEBUGA");
        fetch(`/notebook/obterDadosGraficos/${numeroSerie}`, { cache: 'no-store' })
            .then(function (response) {
                console.log("to dentro do obter dados especificos kpis");
                console.log(response + "deus socorro");

                if (response.ok) {
                    response.json().then(function (resposta) {
                        if (resposta.length > 0) {
                            const usoDisco = resposta[1].usoDisco;
                            const tempoDisco = resposta[4].tempoAtividadeDisco;

                            const tempoFormatado = formatarTempoAtividadeDisco(tempoDisco); //função cheia de calculo para transformar a string que vem em tempoStividadeDisco em horas e minutos para ficar mais bonitinho 

                            document.getElementById("uso_disco").innerHTML = `${usoDisco} GB`;
                            document.getElementById("tempo_disco").innerHTML = `${tempoFormatado}`;
                        } else {
                            console.log('Nenhum dado encontrado');
                        }
                    });
                } else {
                    console.error('ERRO DO  ' + response);
                }
            })
            .catch(function (error) {
                console.error('Erro ao buscar as informações para as KPIs específicas:', error);
            });
    }

    function formatarTempoAtividadeDisco(tempoAtividadeDisco) { // o amigo robo ajudou, ta bem explicativo:
        // Verifica se o tempoAtividadeDisco está definido
        if (!tempoAtividadeDisco) return "";

        // Divide o tempoAtividadeDisco em dias, horas, minutos e segundos
        const partes = tempoAtividadeDisco.split(', ');

        if (partes.length < 2) return ""; // Se não tiver pelo menos 2 partes, retorna vazio

        const dias = parseInt(partes[0].split(' ')[0]); // Extrai os dias e converte para número
        const horasMinutosSegundos = partes[1]; // Extrai horas, minutos e segundos

        // Divide as horas, minutos e segundos
        const [horas, minutos, segundos] = horasMinutosSegundos.split(':').map(item => parseInt(item));

        // Calcula o total de horas e minutos
        const totalHoras = dias * 24 + horas;
        const totalMinutos = minutos;

        // Formata o resultado
        const tempoFormatado = `${totalHoras} horas e ${totalMinutos} minutos`;

        return tempoFormatado;
    }

    function obterDadosGraficos(numeroSerie) {
        if (numeroSerie == null || numeroSerie == '') {
            numeroSerie = selectNotebook.value;
        }


        fetch(`/notebook/obterDadosGraficos/${numeroSerie}`, { cache: 'no-store' })
            .then(function (response) {
                console.log(response.json);
                if (response.ok) {
                    response.json().then(function (resposta) {
                        console.log(resposta);

                        primeira_coluna.innerHTML =
                            `<div  id="primeira_coluna" class="graficosColuna">
                        <div class="graficos">
                            <canvas id="ram${numeroSerie}"></canvas>
                        </div>
                        <div class="graficos">
                            <canvas id="armazenamento${numeroSerie}"></canvas>
                        </div>
                    </div>`;

                        segunda_coluna.innerHTML =
                            `<div  id="segunda_coluna" class="graficosColuna">
                        <div class="graficos">
                            <canvas id="cpu${numeroSerie}"></canvas>
                        </div>
                        <div class="graficos">
                            <canvas id="janelaAtiva${numeroSerie}"></canvas>
                        </div>
                    </div>`;

                        plotarGrafico(numeroSerie, resposta);
                    });
                } else {
                    console.error('Nenhum dado encontrado ou erro na API ' + response);
                }
            })
            .catch(function (error) {
                console.error('Erro ao buscar dados do gráfico:', error);
            });
    }

    // ** Função para ao invés de ter que deletar os gráficos, somente sobrescreve/atualiza os dados conforme o SN selecionado no select ** 
    let cpuChart, ramChart, armazenamentoChart, janelaAtivaChart; // aq vai armazenar os dados

    function plotarGrafico(numeroSerie, resposta) {
        let labelsData = [];
        let cpuData = [];
        let ramData = [];
        let discoData = [];
        let janelasData = [];

        for (let i = 0; i < resposta.length; i++) {
            var registro = resposta[i];
            cpuData.push(registro.usoCpu);
            ramData.push(registro.usoMemoriaRam);
            discoData.push(registro.usoDisco);
            janelasData.push(registro.qtdJanelasEmUso);
            labelsData.push(registro.dtHoraCaptura + 'h');
        }

        const data = {
            cpu: cpuData,
            ram: ramData,
            storageUsage: discoData,
            janelas: janelasData,
            labels: labelsData
        };

        const options = {
            responsive: true,
            maintainAspectRatio: false,
        };

        // Gráficos

        if (cpuChart) { // verifica se já existe o gráfico, se não existir ele cria, se já existir ele só sobrescreve 
            cpuChart.data.labels = data.labels;
            cpuChart.data.datasets[0].data = data.cpu;
            cpuChart.update();
        } else {
            cpuChart = new Chart(document.getElementById(`cpu${numeroSerie}`), {
                type: 'line',
                data: {
                    labels: data.labels,
                    datasets: [{
                        label: 'CPU em Uso',
                        data: data.cpu,
                        backgroundColor: 'rgb(36,153,199,0.25)',
                        borderColor: 'rgb(36,153,199)',
                        fill: true
                    }],
                },
                options: {
                    ...options,
                    scales: {
                        y: {
                            min: 0,
                            max: 100,
                            stepSize: 10,
                        },
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'CPU em Uso ',
                            font: {
                                size: 13,
                            },
                        },
                    },
                },
            });
        }

        if (ramChart) { // verifica se já existe o gráfico, se não existir ele cria, se já existir ele só sobrescreve 
            ramChart.data.labels = data.labels;
            ramChart.data.datasets[0].data = data.ram;
            ramChart.update();
        } else {
            ramChart = new Chart(document.getElementById(`ram${numeroSerie}`), {
                type: 'line',
                data: {
                    labels: data.labels,
                    datasets: [{
                        label: 'RAM em Uso (GB)',
                        data: data.ram,
                        borderColor: 'rgb(189,35,181)',
                        backgroundColor: 'rgba(189,35,181, 0.25)',
                        fill: true
                    }],
                },
                options: {
                    ...options,
                    scales: {
                        y: {
                            min: 0,
                            max: 128,
                            stepSize: 4,
                        },
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'Memória Ram em Uso',
                            font: {
                                size: 13,
                            },
                        },
                    },
                },
            });
        }

        if (armazenamentoChart) { // mesma coisa q os de cima
            armazenamentoChart.data.labels = data.labels;
            armazenamentoChart.data.datasets[0].data = data.storageUsage;
            armazenamentoChart.update();
        } else {
            armazenamentoChart = new Chart(document.getElementById(`armazenamento${numeroSerie}`), {
                type: 'line',
                data: {
                    labels: data.labels,
                    datasets: [{
                        label: 'Disco em Uso (GB)',
                        data: data.storageUsage,
                        borderColor: '#ff7edf',
                        backgroundColor: 'rgb(255,126,223, 0.25)',
                        fill: true
                    }],
                },
                options: {
                    ...options,
                    scales: {
                        y: {
                            min: 0,
                            max: 1000,
                            stepSize: 10,
                        },
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'Disco em Uso',
                            font: {
                                size: 13,
                            },
                        },
                    },
                },
            });
        }

        const ctx = document.getElementById(`janelaAtiva${numeroSerie}`).getContext('2d');
        const data2 = {
            labels: data.labels,
            datasets: [{
                label: 'Qtd. de Janelas Visíveis',
                data: data.janelas,
                backgroundColor: 'rgb(0,255,255,0.25)',
                borderColor: 'rgb(0,255,255)',
                fill: true
            }],
        };

        const options2 = {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true,
                    min: 0,
                    stepSize: 1,
                },
            },
            plugins: {
                title: {
                    display: true,
                    text: 'Quantidade de Janelas Visíveis',
                    font: {
                        size: 13,
                    },
                },
            },
        };

        if (janelaAtivaChart) { // msm coisa, so inverteu 
            janelaAtivaChart.data.labels = data2.labels;
            janelaAtivaChart.data.datasets[0].data = data2.datasets[0].data;
            janelaAtivaChart.update();
        } else {
            janelaAtivaChart = new Chart(ctx, {
                type: 'line',
                data: data2,
                options: options2,
            });
        }

        // atualizarGrafico(numeroSerie, data,janelaChart); 

    }

    function atualizarGrafico(numeroSerie, data, janelaChart) { // function do web data viz q arruma o sentido da att do grafico

        fetch(`/notebook/buscarMedidasEmTempoReal/${numeroSerie}`, { cache: 'no-store' }).then(function (response) {
            if (response.ok) {
                response.json().then(function (novoRegistro) {
                    let novoHorario = novoRegistro[0].dataHora;
                    console.log(`Dados recebidos: ${JSON.stringify(novoRegistro)}`);
                    console.log(`Dados atuais do gráfico:`);
                    console.log(data);

                    if (novoRegistro[0].momento_grafico == data.labels[data.labels.length - 1]) {
                        console.log("---------------------------------------------------------------")
                        console.log("Como não há dados novos para captura, o gráfico não atualizará.")
                        // avisoCaptura.innerHTML = "<i class='fa-solid fa-triangle-exclamation'></i> Foi trazido o dado mais atual capturado pelo sensor. <br> Como não há dados novos a exibir, o gráfico não atualizará."
                        console.log("Horário do novo dado capturado:")
                        console.log(novoRegistro[0].momento_grafico)
                        console.log("Horário do último dado capturado:")
                        console.log(data.labels[data.labels.length - 1])
                        console.log("---------------------------------------------------------------")
                    } else {
                        // tirando e colocando valores no gráfico
                        const janelaLabels = [...janelaChart.data.labels];
                        janelaLabels.shift();
                        janelaLabels.push(novoHorario);
                        janelaChart.data.labels = janelaLabels;
                        const janelaData = [...janelaChart.data.datasets[0].data];
                        janelaData.shift();
                        janelaData.push(novoRegistro[0].qtdJanelasEmUso);
                        console.log(novoRegistro[0].qtdJanelasEmUso);
                        janelaChart.data.datasets[0].data = janelaData;
                        janelaChart.update();
                    }


                    proximaAtualizacao = setTimeout(() => atualizarGrafico(numeroSerie, data, janelaChart), 5000);
                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');

                proximaAtualizacao = setTimeout(() => atualizarGrafico(numeroSerie, data, janelaChart), 5000);
            }
        })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });
    }
</script>